#===============================================================================
# Battle_EnemyShiny
# Edited    July 28 2019
#===============================================================================
# ██████╗  █████╗ ███╗   ███╗███████╗    ██████╗  █████╗ ██████╗ ████████╗██╗   ██╗
#██╔════╝ ██╔══██╗████╗ ████║██╔════╝    ██╔══██╗██╔══██╗██╔══██╗╚══██╔══╝╚██╗ ██╔╝
#██║  ███╗███████║██╔████╔██║█████╗      ██████╔╝███████║██████╔╝   ██║    ╚████╔╝
#██║   ██║██╔══██║██║╚██╔╝██║██╔══╝      ██╔═══╝ ██╔══██║██╔══██╗   ██║     ╚██╔╝
#╚██████╔╝██║  ██║██║ ╚═╝ ██║███████╗    ██║     ██║  ██║██║  ██║   ██║      ██║
# ╚═════╝ ╚═╝  ╚═╝╚═╝     ╚═╝╚══════╝    ╚═╝     ╚═╝  ╚═╝╚═╝  ╚═╝   ╚═╝      ╚═╝
class Game_Party < Game_Unit

  #--------------------------------------------------------------------------
  # * Public Instance Variables
  #--------------------------------------------------------------------------
  attr_accessor   :pityshinychance
  #--------------------------------------------------------------------------
  # * Object Initialization
  #--------------------------------------------------------------------------
  alias mscr_enemyshiny_gameparty_initialize initialize
  def initialize
    mscr_enemyshiny_gameparty_initialize
    @pityshinychance = MSCR::BATTLE::ENEMYSHINYCHANCE
  end

end #Game_Party

# ██████╗  █████╗ ███╗   ███╗███████╗    ███████╗███╗   ██╗███████╗███╗   ███╗██╗   ██╗
#██╔════╝ ██╔══██╗████╗ ████║██╔════╝    ██╔════╝████╗  ██║██╔════╝████╗ ████║╚██╗ ██╔╝
#██║  ███╗███████║██╔████╔██║█████╗      █████╗  ██╔██╗ ██║█████╗  ██╔████╔██║ ╚████╔╝
#██║   ██║██╔══██║██║╚██╔╝██║██╔══╝      ██╔══╝  ██║╚██╗██║██╔══╝  ██║╚██╔╝██║  ╚██╔╝
#╚██████╔╝██║  ██║██║ ╚═╝ ██║███████╗    ███████╗██║ ╚████║███████╗██║ ╚═╝ ██║   ██║
# ╚═════╝ ╚═╝  ╚═╝╚═╝     ╚═╝╚══════╝    ╚══════╝╚═╝  ╚═══╝╚══════╝╚═╝     ╚═╝   ╚═╝
class Game_Enemy < Game_Battler

  #--------------------------------------------------------------------------
  # * Object Initialization
  #--------------------------------------------------------------------------
  alias mscr_enemyshiny_gameenemy_initialize initialize
  def initialize(index, enemy_id)
    mscr_enemyshiny_gameenemy_initialize(index, enemy_id)
    determine_shiny
    @battler_hue += 60 if shiny?
  end
  #--------------------------------------------------------------------------
  # * determine_shiny
  #--------------------------------------------------------------------------
  def determine_shiny
    if enemy.note =~ /<noshiny>/i
      @shiny = false
    else
      if rand_between(1, $game_party.pityshinychance) == 1 || $game_party.pityshinychance == 1
        @shiny = true
        $game_party.pityshinychance = MSCR::BATTLE::ENEMYSHINYCHANCE
      else
        @shiny = false
        $game_party.pityshinychance -= 1
      end
    end
  end
  #--------------------------------------------------------------------------
  # * shiny?
  #--------------------------------------------------------------------------
  def shiny?
    @shiny
  end
  #--------------------------------------------------------------------------
  # * Get Experience
  #--------------------------------------------------------------------------
  def exp
    enemy.exp * (shiny? ? MSCR::BATTLE::SHINYMULTIPLY : 1)
  end
  #--------------------------------------------------------------------------
  # * Get Gold
  #--------------------------------------------------------------------------
  def gold
    enemy.gold * (shiny? ? MSCR::BATTLE::SHINYMULTIPLY : 1)
  end

end #Game_Enemy

#██████╗  █████╗ ████████╗████████╗██╗     ███████╗    ███╗   ███╗ █████╗ ███╗   ██╗ █████╗  ██████╗ ███████╗██████╗
#██╔══██╗██╔══██╗╚══██╔══╝╚══██╔══╝██║     ██╔════╝    ████╗ ████║██╔══██╗████╗  ██║██╔══██╗██╔════╝ ██╔════╝██╔══██╗
#██████╔╝███████║   ██║      ██║   ██║     █████╗      ██╔████╔██║███████║██╔██╗ ██║███████║██║  ███╗█████╗  ██████╔╝
#██╔══██╗██╔══██║   ██║      ██║   ██║     ██╔══╝      ██║╚██╔╝██║██╔══██║██║╚██╗██║██╔══██║██║   ██║██╔══╝  ██╔══██╗
#██████╔╝██║  ██║   ██║      ██║   ███████╗███████╗    ██║ ╚═╝ ██║██║  ██║██║ ╚████║██║  ██║╚██████╔╝███████╗██║  ██║
#╚═════╝ ╚═╝  ╚═╝   ╚═╝      ╚═╝   ╚══════╝╚══════╝    ╚═╝     ╚═╝╚═╝  ╚═╝╚═╝  ╚═══╝╚═╝  ╚═╝ ╚═════╝ ╚══════╝╚═╝  ╚═╝
module BattleManager

  #--------------------------------------------------------------------------
  # * gain_drop_items
  #--------------------------------------------------------------------------
  class << self; alias mscr_enemyshiny_battlemanager_gaindropitems gain_drop_items; end
  def self.gain_drop_items
    $game_troop.members.each do |enemy|
      $game_party.gain_item($data_items[1], 1) if enemy.shiny?
    end
    mscr_enemyshiny_battlemanager_gaindropitems
  end

end #BattleManager

# ██████╗  █████╗ ███╗   ███╗███████╗    ████████╗██████╗  ██████╗  ██████╗ ██████╗
#██╔════╝ ██╔══██╗████╗ ████║██╔════╝    ╚══██╔══╝██╔══██╗██╔═══██╗██╔═══██╗██╔══██╗
#██║  ███╗███████║██╔████╔██║█████╗         ██║   ██████╔╝██║   ██║██║   ██║██████╔╝
#██║   ██║██╔══██║██║╚██╔╝██║██╔══╝         ██║   ██╔══██╗██║   ██║██║   ██║██╔═══╝
#╚██████╔╝██║  ██║██║ ╚═╝ ██║███████╗       ██║   ██║  ██║╚██████╔╝╚██████╔╝██║
# ╚═════╝ ╚═╝  ╚═╝╚═╝     ╚═╝╚══════╝       ╚═╝   ╚═╝  ╚═╝ ╚═════╝  ╚═════╝ ╚═╝
class Game_Troop < Game_Unit

  #--------------------------------------------------------------------------
  # * Processing at Start of Battle
  #--------------------------------------------------------------------------
  alias mscr_enemyshiny_gametroop_onbattlestart on_battle_start
  def on_battle_start
    mscr_enemyshiny_gametroop_onbattlestart
    members.each {|member| member.animation_id = 2 if member.shiny? }
  end

end #Game_Troop
